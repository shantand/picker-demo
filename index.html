<script src="https://accounts.google.com/gsi/client"></script>
<script src="https://apis.google.com/js/api.js"></script>
<script>
  const CLIENT_ID = "CLIENT_ID";
  const API_KEY = "API_KEY";
  const SCOPES = "https://www.googleapis.com/auth/drive.readonly";
  let oauthToken;

  function createPicker() {
    const view = new google.picker.DocsView(google.picker.ViewId.DOCS)
      .setIncludeFolders(true)
      .setSelectFolderEnabled(true);

    const picker = new google.picker.PickerBuilder()
      .setDeveloperKey(API_KEY)
      .setOAuthToken(oauthToken)
      .addView(view)
      .setCallback((data) => {
        if (data.action === google.picker.Action.PICKED) {
          console.log(data.docs);
        }
      })
      .build();
    picker.setVisible(true);
  }

  const tokenClient = google.accounts.oauth2.initTokenClient({
    client_id: CLIENT_ID,
    scope: SCOPES,
    callback: (tokenResponse) => {
      oauthToken = tokenResponse.access_token;
      createPicker();
    }
  });

  window.onload = () => {
    gapi.load("picker", () => console.log("Picker loaded"));
    document.getElementById("auth-btn").onclick = () => {
      tokenClient.requestAccessToken();
    };
  };
</script>
